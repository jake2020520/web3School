自查目标：

1. 了解 Solidity 中支持的循环类型
2. 掌握循环语句的基本语法和使用方法
3. 学会在智能合约中合理使用循环

课程内容：


---

第一节：循环的基本类型

Solidity 支持三种基本的循环结构：
1. for 循环
2. while 循环
3. do-while 循环


---

第二节：for 循环

- 基本语法：
contract ForLoopExample {
    function basicFor() public pure returns(uint) {
        uint sum = 0;
        
        for(uint i = 0; i < 10; i++) {
            sum += i;
        }
        
        return sum;
    }
}

- for 循环的变体：
contract ForLoopVariants {
    // 无初始化语句
    function forWithoutInit() public pure {
        uint i = 0;
        for(; i < 10; i++) {
            // 循环体
        }
    }
    
    // 无条件语句
    function forWithoutCondition() public pure {
        for(uint i = 0;; i++) {
            if(i >= 10) break;
            // 循环体
        }
    }
    
    // 无递增语句
    function forWithoutIncrement() public pure {
        for(uint i = 0; i < 10;) {
            // 循环体
            i++;
        }
    }
}


---

第三节：while 循环

- 基本语法：
contract WhileLoopExample {
    function basicWhile() public pure returns(uint) {
        uint sum = 0;
        uint i = 0;
        
        while(i < 10) {
            sum += i;
            i++;
        }
        
        return sum;
    }
}


---

第四节：do-while 循环

- 基本语法：
contract DoWhileExample {
    function basicDoWhile() public pure returns(uint) {
        uint sum = 0;
        uint i = 0;
        
        do {
            sum += i;
            i++;
        } while(i < 10);
        
        return sum;
    }
}


---

第五节：循环控制语句

1. break 语句：
contract BreakExample {
    function findFirstEven(uint[] memory numbers) public pure returns(uint) {
        for(uint i = 0; i < numbers.length; i++) {
            if(numbers[i] % 2 == 0) {
                return numbers[i];
            }
        }
        return 0;
    }
}

2. continue 语句：
contract ContinueExample {
    function sumOddNumbers(uint[] memory numbers) public pure returns(uint) {
        uint sum = 0;
        
        for(uint i = 0; i < numbers.length; i++) {
            if(numbers[i] % 2 == 0) {
                continue;
            }
            sum += numbers[i];
        }
        
        return sum;
    }
}


---

第六节：Gas 优化考虑

1. 避免无限循环：
contract GasOptimization {
    // 不推荐：可能导致 gas 耗尽
    function riskyLoop() public pure {
        uint i = 0;
        while(true) {
            i++;
            if(i >= 10) break;
        }
    }
    
    // 推荐：明确的循环边界
    function safeLoop() public pure {
        for(uint i = 0; i < 10; i++) {
            // 循环体
        }
    }
}

2. 优化数组循环：
contract ArrayLoopOptimization {
    // 不推荐：每次循环都要读取数组长度
    function inefficientLoop(uint[] memory arr) public pure {
        for(uint i = 0; i < arr.length; i++) {
            // 循环体
        }
    }
    
    // 推荐：缓存数组长度
    function efficientLoop(uint[] memory arr) public pure {
        uint length = arr.length;
        for(uint i = 0; i < length; i++) {
            // 循环体
        }
    }
}


---


实践作业

1. 实现一个函数，计算斐波那契数列的第 n 项（注意 gas 限制）。

2. 编写一个合约，实现以下功能：
  - 批量添加白名单地址
  - 检查数组中是否存在重复元素
  - 计算数组中所有偶数的和

3. 优化一个现有的包含循环的合约，使其 gas 消耗更低。


---